<!DOCTYPE html>
<html lang=en>
 <head>
  <meta charset=UTF-8>
  <link rel=stylesheet
        href=https://unpkg.com/tachyons/css/tachyons.min.css>
  <style>code {
                  background-color: gray;
                  color: white;
                  }</style>
  <meta name=viewport
        content="width=device-width, initial-scale=1.0">
  <title>Working with file uploads on IE9 and Rails &lt; 4</title>
 </head>
 <body class="athelas pa3 pa5-l pa5-m">
  <header>
   <h1><a class="link dim black b db mb3 mb4-ns" href=../index.html title=M2AS>M2AS</a></h1>
  </header>
  <article class="cf pt3">
   <header class="fn fl-l w-50-l pr4-l pb4">
    <h1
        class="f2 lh-title fw9 mb3 mt0 pt3 bt bw2">Working with file uploads on IE9 
     and Rails &lt; 4</h1>
    <h2 class="f3 mid-gray lh-title"></h2>
    <time class="f3 ttu tracked gray">2015-09-10</time>
   </header>
   <div class="fn fl-l w-50-l bt bw1 bn-l">
    <div class="f4 lh-copy measure"><p>I am trying to get back into the swing of documenting my findings as I wrestle with tough bugs and issues. Often times I just plough on with the solution but don't bother to reflect on how I got to it, and it's a valuable excercise to train one's train of thought. In other words, <strong>warning</strong>: You are about to head into a rant of rabbit holes and sad IE exceptions. </p><p><a href="#solution">Click here to just get to the solution I found.</a> </p><p>Sadly though, some stories don't end up with a happy closure. There are times where one must lick one's wounds and surrender to a completely different solution than what one expected. Let me explain the quandary. </p><p>I'm working on a Rails 3 app which, among many other things, uploads files. A very simple operation that rails out of the box supports using its <code>ujs</code>, but you can certainly switch over to jquery's fine <a href="https://github.com/blueimp/jQuery-File-Upload">file upload</a> plugin to gain access to drag-drop, and all sorts of other goodies. All is fine until we test in the <em>only</em> browser the client seems to like - <a href="http://youtu.be/vTTzwJsHpU8">good old IE9</a>. </p><p>Turns out that <a href="http://stackoverflow.com/a/13497736/2785476">ie9 doesn't support XMLHttpRequest</a>, but the workaround is to submit an <code>iFrame</code> with the contents of our request. And in order to do that, one needs the ability to add hooks to jquery's <code>ajax</code>, which happens starting v1.5 (or perhaps write the entire <code>iFrame</code> code). </p><p>For reasons unknown, this particular project uses an archaic version of <a href="http://www.javascriptmvc.com/">JavaScriptMVC</a> that wasn't fully integrated as its creators intended - and refactoring into something more common or even the newest version is out of the question for the time being. The included version for jquery was 1.4 (and there was no clear guidelines on upgrading portions individually), so I hacked through jquery versions until the remaining JMVC code didn't complain (1.4 -&gt; 1.6 gains you ajax hooks on Jquery and a bunch of bug fixes, which were needed for the <a href="https://cmlenz.github.io/jquery-iframe-transport/">iframe transport</a>  included in <code>fileupload</code> plugin. </p><p>Once that was set up, I ran into <a href="https://stackoverflow.com/questions/1744310/how-to-fix-array-indexof-in-javascript-for-internet-explorer-browsers">older IE9 implementations not supporting Array.indexOf</a>. That was finally fixed with a shim that gets included directly into the code, and at this point we're ready to continue. </p><p>If you read this far down, your head must be hurting as much as mine. Brace yourself - we keep on going! </p><p>This brought me into diving into <code>jquery-ujs</code> and how it was being used in the site. I spent too much time reading into it (but leanred a bunch on the actual implementation), only to come back to the crux of the matter: with some form changes (namely, adding a <code>submit</code> input) I was finally sending the file to Rails, yet <code>fileuploader</code> was not handling the response correctly. </p><p>I've tried every use-case, scoured the SO seas and spent a couple of days in the wonderful world of frontend exceptions and IE-specific woes. And at this point, I've reached too far in. Time to back out and <a href="https://stackoverflow.com/questions/32511830/rails-3-ie9-jquery-fileupload-no-callbacks-are-triggered">actually throw a question out to the internet</a>. </p><h2>How it All Actually Ended Up</h2><p><a name="solution"></a>  </p><p>A coworker introduced me to <a href="http://www.plupload.com/">Plupload</a>, which was created in a previous era of aggressive browsers and little to no standarization. We have an app with older code that actually works with that, so I'm probably going to take that code and continue on with my life. Sometimes you have to take your learnings and move on. </p><p>I wonder how that applies to the rest of one's life experience... </p>
    </div>
   </div>
  </article>
  <footer class="pv4 ph3 ph5-m ph6-l mid-gray">
   <span class="f3 db tc">(C) AD 2023</span>
  </footer>
 </body>
</html>